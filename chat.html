<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Gemini Multi-View (Com Nomes)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        /* Estilos CSS (incluindo user-id-tag e botão ativo) */
        html, body { height: 100%; overflow: hidden; }
        body { display: flex; flex-direction: column; }
        .main-container-wrapper { flex-grow: 1; overflow-y: auto; }
        .message-enter { animation: messageEnter 0.3s ease-out; }
        @keyframes messageEnter { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .typing-indicator::after { content: "..."; animation: typingDots 1.5s infinite; }
        @keyframes typingDots { 0%, 20% { content: "."; } 40% { content: ".."; } 60%, 100% { content: "..."; } }
        .markdown-content p { margin-bottom: 0.5rem; }
        .markdown-content ul, .markdown-content ol { margin-left: 1.25rem; list-style: inside; margin-bottom: 0.5rem; }
        .markdown-content li { margin-bottom: 0.25rem; }
        .markdown-content code { background-color: #e5e7eb; color: #1f2937; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; font-size: 0.9em; word-break: break-all; }
        .markdown-content pre { background-color: #e5e7eb; border: 1px solid #d1d5db; padding: 0.75rem; border-radius: 0.375rem; overflow-x: auto; margin-bottom: 0.75rem; }
        .markdown-content pre code { background-color: transparent; padding: 0; border-radius: 0; font-size: 0.85em; word-break: normal; }
        .markdown-content strong { font-weight: 600; }
        .markdown-content em { font-style: italic; }
        .markdown-content ul ul, .markdown-content ol ol, .markdown-content ul ol, .markdown-content ol ul { margin-left: 1.25rem; }
        .markdown-content a { color: #2563eb; text-decoration: underline; }
        .markdown-content a:hover { color: #1d4ed8; }
        .user-id-tag { font-size: 0.7rem; font-weight: bold; margin-left: 5px; padding: 1px 4px; background-color: #d1d5db; border-radius: 4px; color: #4b5563; }
        .chat-view-button-active { background-color: #4f46e5 !important; color: white !important; }
        .chat-view-button { background-color: #e5e7eb; color: #374151; transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; }
        .chat-view-button:hover { background-color: #d1d5db; }
        .username-input { transition: all 0.3s ease; }
        .username-input:focus { transform: scale(1.05); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-gray-100 font-sans">

<div id="welcome-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Bem-vindo ao Chat Gemini!</h2>
        <input type="text" id="username-input" placeholder="Escolha um nome de usuário" class="username-input w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        <button id="save-username-btn" class="w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200 font-semibold">
            Salvar e Entrar
        </button>
        <p class="text-sm text-gray-500 mt-3">Seu nome será público e usado para outros usuários encontrarem seu chat.</p>
        <p id="username-error" class="text-sm text-red-500 mt-2 h-4"></p> </div>
</div>

<div class="main-container-wrapper container mx-auto max-w-4xl p-2 sm:p-4 flex flex-col h-full">

    <header class="bg-indigo-600 text-white rounded-lg shadow-md p-3 sm:p-4 mb-3 sm:mb-4 flex items-center justify-between flex-shrink-0">
        <div class="flex items-center space-x-2 sm:space-x-3">
            <i class="fas fa-robot text-xl sm:text-2xl"></i>
            <h1 class="text-lg sm:text-xl font-bold">Chat Gemini Multi-View</h1>
        </div>
        <div class="flex items-center space-x-4">
            <div id="user-info" class="text-xs flex items-center">
                 <span id="username-display" class="bg-white text-indigo-600 px-2 py-0.5 rounded-full font-medium text-center min-w-[60px]">...</span>
                 <span class="ml-2 hidden sm:inline">ID: <span id="device-id-display" title="ID Completo do Dispositivo">Carregando...</span></span>
            </div>
            <div id="user-status" class="flex items-center space-x-2">
                 <span id="status-indicator" class="h-3 w-3 rounded-full bg-gray-300"></span>
                 <span id="status-text" class="text-xs sm:text-sm">Offline</span>
            </div>
        </div>
    </header>

    <div class="mb-3 sm:mb-4 bg-white p-3 rounded-lg shadow-md flex-shrink-0 flex flex-col md:flex-row gap-4">
        <div>
            <label for="model-select" class="block text-sm font-medium text-gray-700 mb-1">Modelo:</label>
            <select id="model-select" name="model-select" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md border">
            </select>
        </div>
        <div class="flex-grow">
            <label class="block text-sm font-medium text-gray-700 mb-1">Visualizar Chat:</label>
            <div class="flex flex-wrap gap-2 items-center">
                <button id="btn-general-chat" class="chat-view-button chat-view-button-active px-3 py-1 rounded text-sm font-medium">Geral</button>
                <button id="btn-my-chat" class="chat-view-button px-3 py-1 rounded text-sm font-medium">Meu Chat</button>
                <div class="flex items-center gap-1 flex-grow sm:flex-grow-0">
                    <input type="text" id="user-search-input" placeholder="Nome ou ID usuário" class="px-2 py-1 border border-gray-300 rounded text-sm focus:ring-indigo-500 focus:border-indigo-500 w-full sm:w-32 md:w-40">
                    <button id="btn-other-chat" class="chat-view-button px-3 py-1 rounded text-sm font-medium whitespace-nowrap">Ver Outro</button>
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-1" id="current-chat-info">Visualizando: Chat Geral</p>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col flex-grow min-h-0">
        <div id="chat-messages" class="p-3 sm:p-4 space-y-4 overflow-y-auto flex-grow min-h-0">
            <div class="text-center text-gray-500 py-10 initial-message">
                <i class="fas fa-comments text-3xl sm:text-4xl mb-2"></i>
                <p class="text-sm sm:text-base">Carregando...</p>
            </div>
        </div>
        <div id="typing-indicator" class="hidden bg-gray-100 px-3 sm:px-4 py-2 text-gray-500 text-xs sm:text-sm flex-shrink-0">
            <span class="typing-indicator">Gemini está digitando</span>
        </div>
        <div class="border-t border-gray-200 p-2 sm:p-4 bg-gray-50 flex-shrink-0">
            <form id="message-form" class="flex space-x-2">
                <input id="message-input" type="text" placeholder="Digite sua mensagem..." class="flex-1 px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm sm:text-base" autocomplete="off" disabled>
                <button type="submit" aria-label="Enviar mensagem" class="bg-indigo-600 text-white px-3 sm:px-4 py-2 rounded-full hover:bg-indigo-700 transition-colors duration-200 flex items-center justify-center" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
            <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                <span id="connection-status">Conectando...</span>
                <span id="message-count">0 msgs</span>
            </div>
        </div>
    </div>
</div>

<script type="module">
   const _0x383c84=_0x5c4b;function _0x35f0(){const _0x51d076=['Usando\x20ID\x20de\x20dispositivo\x20existente:','\x27\x20não\x20encontrado.\x20Verifique\x20o\x20nome\x20ou\x20ID.','):\x20','justify-center','justify-start','178297qSeiFf','startsWith','...','Erro\x20crítico:\x20ID\x20do\x20modelo\x20inválido\x20após\x20sanitização.','Inicialização\x20do\x20Gemini\x20falhou\x20ou\x20referência\x20Firebase\x20inválida.\x20Listener\x20não\x20anexado.','Reconectado\x20ao\x20Firebase.','button[type=\x22submit\x22]','Salvando/Atualizando\x20usuário\x20no\x20Firebase:\x20ID=','text','ID\x20Completo:\x20','56912weaqEU','preventDefault','Não\x20inicializando\x20objeto\x20de\x20chat\x20Gemini\x20para\x20view\x20\x27other\x27.','trim','Erro\x20crítico:\x20SDK\x20Gemini\x20não\x20disponível.','377005kSPxin','option','Erro\x20interno:\x20Não\x20foi\x20possível\x20determinar\x20onde\x20salvar\x20sua\x20mensagem.','split','Aguardando\x20configuração\x20inicial\x20do\x20usuário\x20antes\x20de\x20carregar\x20o\x20chat.','own','username','\x20mb-2\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','admin','remove','userDeviceId','Quota','\x20rounded-xl\x20px-3\x20py-1.5\x20max-w-[90%]\x20sm:max-w-md\x20lg:max-w-lg\x20text-xs\x20sm:text-sm\x20text-center\x20system-message\x20shadow-sm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','appendChild','shift','931264VKXsYq','startChat','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-start\x20mb-2\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','message-input','Erro\x20ao\x20comunicar\x20com\x20Gemini\x20ou\x20salvar\x20resposta\x20(','bg-red-100\x20text-red-800','Digite\x20um\x20nome\x20ou\x20ID\x20de\x20usuário\x20para\x20buscar.','Salvar\x20e\x20Entrar','Offline','generalChat/','user','Erro\x20ao\x20buscar\x20nome\x20\x27','div','Online','Não\x20é\x20possível\x20enviar\x20mensagens\x20nesta\x20visualização.','bg-yellow-100\x20text-yellow-800','permission_denied','Erro\x20ao\x20processar\x20sua\x20mensagem\x20com\x20','Usuário\x20com\x20ID\x20\x27','database','\x27,\x20Model=\x27','Aguardando\x20resposta\x20do\x20Gemini...','test','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','.\x20A\x20funcionalidade\x20de\x20IA\x20pode\x20não\x20funcionar.','Erro:\x20ID\x20do\x20modelo\x20inválido\x20ao\x20tentar\x20salvar\x20mensagem.','selected','submit','length','pulse','Novo\x20ID\x20de\x20dispositivo\x20criado:','Outro\x20(','Chat\x20Geral','flex','Desanexando\x20listener\x20Firebase\x20anterior\x20da\x20Ref:','<pre><code>','general','response','Erro:\x20ID\x20do\x20dispositivo\x20não\x20definido.','Erro\x20CRÍTICO\x20ao\x20carregar\x20histórico\x20ou\x20anexar\x20listener\x20para\x20','<div\x20class=\x22text-center\x20text-red-500\x20py-10\x22><p>Erro\x20ao\x20carregar\x20dados!\x20Verifique\x20as\x20permissões\x20ou\x20o\x20console\x20para\x20detalhes.</p></div>','message-enter','O\x20chat\x20não\x20pôde\x20ser\x20iniciado\x20corretamente.\x20O\x20envio\x20de\x20mensagens\x20está\x20desabilitado.','11EbRiBM','Listener\x20recebeu\x20snapshot\x20nulo:','Nome\x20de\x20usuário\x20encontrado\x20localmente:\x20','Chave\x20da\x20API\x20Gemini\x20não\x20configurada!\x20Substitua\x20o\x20placeholder\x20no\x20código.','chat-messages','Histórico\x20inicial\x20carregado\x20para\x20','873ApkxqM','addEventListener','1080485760423','Erro\x20ao\x20salvar\x20dados\x20do\x20usuário\x20no\x20Firebase:',')\x20salva\x20em\x20','28rHTCpy','justify-end','Falha\x20(','child_added','username-display','once','Nome\x20deve\x20ter\x20entre\x203\x20e\x2015\x20caracteres.','Erro\x20interno\x20ao\x20preparar\x20para\x20salvar\x20resposta.','\x20rounded-r-lg\x20rounded-tl-lg\x20px-3\x20py-2\x20max-w-[80%]\x20sm:max-w-[75%]\x20break-words\x20text-sm\x20sm:text-base\x20shadow-sm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22markdown-content\x22>','key','400','users/','404','815318frgagI','code','getItem','.initial-message','414756xtTpVA','user-','getMonth','status-text','<div\x20class=\x22text-center\x20text-red-500\x20py-10\x20initial-message\x22><i\x20class=\x22fas\x20fa-user-slash\x20text-3xl\x20sm:text-4xl\x20mb-2\x22></i><p\x20class=\x22text-sm\x20sm:text-base\x22>Usuário\x20não\x20existe.</p></div>','username-input','...\x27\x20não\x20encontrado\x20no\x20banco\x20de\x20dados.','bg-blue-100\x20text-blue-900\x20rounded-r-lg\x20rounded-tl-lg','<ul>','placeholder','Desconectado','setItem','1295368tJHLnM','Erro:\x20ID\x20do\x20dispositivo\x20do\x20usuário\x20não\x20definido\x20para\x20carregar\x20\x27Meu\x20Chat\x27.','1:1080485760423:web:8e4befd62dbf6106ff7a82','<br>','\x27\x20(encontrado\x20ou\x20digitado)\x20não\x20existe\x20no\x20nó\x20/users.','2-digit','Erro\x20crítico:\x20Não\x20foi\x20possível\x20conectar\x20ao\x20Firebase.\x20Verifique\x20as\x20configurações\x20no\x20código.','Erro\x20(','Status\x20Conexão\x20Firebase:','<div\x20class=\x22text-center\x20text-gray-500\x20py-10\x20initial-message\x22><i\x20class=\x22fas\x20fa-comments\x20text-3xl\x20sm:text-4xl\x20mb-2\x22></i><p\x20class=\x22text-sm\x20sm:text-base\x22>Nenhuma\x20mensagem\x20neste\x20chat\x20ainda.</p></div>','Erro\x20ao\x20verificar\x20usuário.\x20Tente\x20novamente.','):\x20Erro\x20de\x20rede\x20ao\x20contatar\x20a\x20API\x20Gemini.\x20Verifique\x20sua\x20conexão.','push','Modal\x20de\x20boas-vindas\x20não\x20encontrado\x20no\x20DOM.','API\x20key\x20not\x20valid','max','<a\x20href=\x22$2\x22\x20target=\x22_blank\x22\x20rel=\x22noopener\x20noreferrer\x22\x20class=\x22text-blue-600\x20hover:underline\x22>$1</a>','title','-latest','DOM\x20Carregado.\x20Iniciando\x20aplicação...','Visualizando\x20chat\x20de\x20outro\x20usuário...','bg-red-500','message','toggle',')\x20inicializado\x20com\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','bg-gray-100\x20sm:bg-gray-200\x20text-gray-800','Erro:\x20Usuário\x20não\x20configurado\x20corretamente.','user-search-input','getGenerativeModel','):\x20Cota\x20da\x20API\x20excedida.\x20Não\x20é\x20possível\x20processar\x20mais\x20mensagens\x20no\x20momento.','Erro\x20ao\x20enviar\x20sua\x20mensagem.\x20Verifique\x20sua\x20conexão\x20e\x20tente\x20novamente.','error','.\x20Verifique\x20sua\x20conexão.','<strong>$1</strong>','device-id-display','Mensagem\x20de\x20erro\x20do\x20Gemini\x20salva\x20no\x20Firebase:','Conexão\x20com\x20o\x20Firebase\x20perdida.\x20Tentando\x20reconectar...','&quot;','\x20começando\x20em\x20','classList','Erro\x20grave\x20ao\x20carregar\x20o\x20histórico\x20do\x20chat.','Nenhum\x20histórico\x20encontrado\x20para\x20','bg-green-500','keys','\x27\x20definido\x20e\x20salvo.','Erro\x20ao\x20verificar.\x20Tente\x20novamente.','model-select','falha','Mensagem\x20do\x20usuário\x20(','Erro\x20interno\x20ao\x20salvar\x20a\x20resposta.',',\x20Nome=','add','set','</li>','message-form','info','target','Chat\x20de\x20','typing-indicator','Visualizando:\x20','text-blue-400','chat-view-button','TIMESTAMP','Interface\x20inicializada.','Erro\x20interno:\x20ID\x20do\x20modelo\x20não\x20especificado.','\x27,\x20Target=\x27','7hhzkec','Falha\x20ao\x20inicializar\x20chat\x20(','):\x20Cota\x20da\x20API\x20Gemini\x20excedida.',')\x20com\x20','off','<code>','Resposta\x20do\x20Gemini\x20salva\x20no\x20Firebase:','orderByChild','log','gemini-1.5-flash-latest','<div\x20class=\x22text-center\x20text-red-500\x20py-10\x22><p>','welcome-modal','&lt;','timestamp','btn-my-chat','querySelectorAll',')\x20pronto.','usernames/','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20','Tentativa\x20de\x20salvar\x20usuário\x20no\x20Firebase\x20sem\x20ID\x20ou\x20Nome.','ID\x20do\x20modelo\x20não\x20fornecido\x20para\x20initGeminiChat.','</p>','now','Meu\x20Chat\x20Pessoal','msg-','&gt;','ServerValue','<li>','<span\x20class=\x22user-id-tag\x22\x20title=\x22ID:\x20','click','):\x20Modelo\x20não\x20encontrado\x20(404).\x20Verifique\x20o\x20ID\x20do\x20modelo.','Erro\x20desconhecido\x20na\x20API\x20Gemini.','disabled','Erro\x20ao\x20inicializar\x20Gemini\x20Chat\x20(','Termo\x20\x27','⚠️\x20Lembre-se:\x20Para\x20ver\x20o\x20chat\x20de\x20outro\x20usuário,\x20as\x20Regras\x20de\x20Segurança\x20do\x20Firebase\x20devem\x20permitir\x20leitura\x20em\x20\x27userChats/','</p></div>','66jTNzUl','geral','val','\x27\x20não\x20encontrado.</p></div>','exists','getElementById','deviceId','model','Não\x20foi\x20possível\x20determinar\x20o\x20caminho\x20do\x20chat\x20no\x20Firebase.','.chat-view-button','ref','Inicializando\x20chat...','cursor-not-allowed','520059pBuFec','Mensagem\x20bloqueada\x20por\x20','G-VD9JE84V5N','innerHTML','...</span>','opacity-50','<p>','focus','includes','quota','Erro:\x20O\x20objeto\x20de\x20chat\x20não\x20está\x20inicializado.','save-username-btn','textContent','Iniciando\x20modelo:\x20','gemini-1.5-','&#039;','random','AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXX','promptFeedback','<ol>','bg-gray-100','bloqueado','Dados\x20do\x20usuário\x20salvos\x20no\x20Firebase\x20com\x20sucesso.','connection-status','Desconhecido','<div\x20class=\x22text-center\x20text-gray-500\x20py-10\x20initial-message\x22><i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x20text-3xl\x20sm:text-4xl\x20mb-2\x22></i><p\x20class=\x22text-sm\x20sm:text-base\x22>Carregando\x20mensagens...</p></div>','Use\x20apenas\x20letras,\x20números,\x20_\x20ou\x20-.\x20Sem\x20espaços.','AIzaSyDF5wOFJPEuhrlD9s0m1ZjYLg-IIPWsCRg','Erro\x20de\x20rede\x20ao\x20tentar\x20contatar\x20','warn','toLowerCase','Definida\x20nova\x20referência\x20Firebase\x20para:\x20','\x20-\x20','Verificando...','success','keypress','Erro\x20formatar\x20hora:','replace',',\x20view:\x20','Este\x20nome\x20já\x20está\x20em\x20uso!','\x20msgs\x20(','Geral','toLocaleTimeString','status-indicator','hidden','13852JfCBmD','5072814LsxzzG','Digite\x20sua\x20mensagem...','Por\x20favor,\x20insira\x20um\x20nome\x20de\x20usuário\x20ou\x20ID\x20para\x20buscar.','3974420JzuckF','Buscando\x20usuário:\x20','message-count','Chat\x20(','Mensagem\x20com\x20texto\x20vazio\x20encontrada\x20no\x20histórico,\x20pulando\x20para\x20Gemini:','Enter','\x27\x20não\x20encontrado\x20no\x20índice.','fetch','<div\x20class=\x22text-center\x20text-gray-500\x20py-10\x20initial-message\x22><i\x20class=\x22fas\x20fa-user-clock\x20text-3xl\x20sm:text-4xl\x20mb-2\x22></i><p\x20class=\x22text-sm\x20sm:text-base\x22>Por\x20favor,\x20defina\x20seu\x20nome\x20de\x20usuário\x20primeiro.</p></div>','g1.5-','\x20mensagens.','Nome\x20de\x20usuário\x20\x27','<div\x20class=\x22text-center\x20text-red-500\x20py-10\x20initial-message\x22><i\x20class=\x22fas\x20fa-question-circle\x20text-3xl\x20sm:text-4xl\x20mb-2\x22></i><p\x20class=\x22text-sm\x20sm:text-base\x22>Não\x20foi\x20possível\x20encontrar\x20o\x20usuário.</p></div>','Meu','DOMContentLoaded','name','sender','initializeApp','Iniciando\x20carregamento:\x20View=\x27','<div\x20class=\x22text-center\x20text-gray-500\x20py-10\x20initial-message\x22><i\x20class=\x22fas\x20fa-search\x20text-3xl\x20sm:text-4xl\x20mb-2\x22></i><p\x20class=\x22text-sm\x20sm:text-base\x22>Digite\x20um\x20nome\x20ou\x20ID\x20acima\x20para\x20ver\x20o\x20chat.</p></div>','...)','.info/connected','RESOURCE_EXHAUSTED','Network\x20Error','Erro\x20ao\x20salvar\x20mensagem\x20do\x20usuário\x20no\x20Firebase:','join','current-chat-info','Erro\x20Gemini\x20(','482884igkltX','__CB_','match','getDate','toString','\x20Para\x20ver\x20o\x20chat\x20de\x20outro\x20usuário,\x20as\x20regras\x20para\x20\x27/userChats/$userId\x27\x20devem\x20permitir\x20leitura.','não\x20foi\x20possível\x20processar','Erro\x20ao\x20verificar\x20existência\x20do\x20usuário\x20','text-indigo-200','change','):\x20Chave\x20da\x20API\x20inválida.\x20Verifique\x20a\x20configuração.','\x20Detalhes:\x20','.\x20Verifique\x20as\x20Regras\x20de\x20Segurança\x20do\x20Firebase\x20Database.','createElement','value','username-error','bg-green-100\x20text-green-800','other','substring','gaamini-teste-api.firebaseapp.com','AIzaSyBL7oI8tr3rseMyQW6ouPVwbfZKGUfwJ1s'];_0x35f0=function(){return _0x51d076;};return _0x35f0();}(function(_0x2762a0,_0x212158){const _0x25e7c3=_0x5c4b,_0x5aff4e=_0x2762a0();while(!![]){try{const _0x124968=parseInt(_0x25e7c3(0x1c3))/0x1*(-parseInt(_0x25e7c3(0x282))/0x2)+-parseInt(_0x25e7c3(0x255))/0x3+-parseInt(_0x25e7c3(0x2da))/0x4+parseInt(_0x25e7c3(0x2cb))/0x5+-parseInt(_0x25e7c3(0x1d4))/0x6+-parseInt(_0x25e7c3(0x223))/0x7*(-parseInt(_0x25e7c3(0x1e0))/0x8)+parseInt(_0x25e7c3(0x283))/0x9;if(_0x124968===_0x212158)break;else _0x5aff4e['push'](_0x5aff4e['shift']());}catch(_0x3f152a){_0x5aff4e['push'](_0x5aff4e['shift']());}}}(_0x35f0,0x202a1));function _0xe21a(){const _0x26d483=_0x5c4b,_0x27dc34=['):\x20Chave\x20da\x20API\x20Gemini\x20inválida\x20ou\x20expirada.\x20Verifique\x20a\x20chave\x20no\x20código.',_0x26d483(0x1ba),'gaamini-teste-api.appspot.com',_0x26d483(0x2ce),_0x26d483(0x23e),_0x26d483(0x266),_0x26d483(0x24b),_0x26d483(0x1c9),_0x26d483(0x2ec),_0x26d483(0x23f),_0x26d483(0x2ea),_0x26d483(0x262),_0x26d483(0x2d0),'sistema','warn','\x20mt-1\x20text-right\x22>',_0x26d483(0x2be),_0x26d483(0x288),_0x26d483(0x201),'Não\x20inicializando\x20objeto\x20\x27chat\x27\x20para\x20a\x20view:',_0x26d483(0x1c8),_0x26d483(0x1eb),_0x26d483(0x215),_0x26d483(0x1dc),_0x26d483(0x1f2),'isError',_0x26d483(0x296),'Nenhum\x20nome\x20de\x20usuário\x20local\x20encontrado.\x20Mostrando\x20modal.',_0x26d483(0x247),_0x26d483(0x233),_0x26d483(0x270),'.initial-message','Carregando\x20ou\x20indisponível...',_0x26d483(0x1de),_0x26d483(0x204),_0x26d483(0x230),_0x26d483(0x1b6),'gaamini-teste-api',_0x26d483(0x2e3),_0x26d483(0x218),_0x26d483(0x26d),_0x26d483(0x2c7),_0x26d483(0x1c4),_0x26d483(0x1a8),_0x26d483(0x21a),_0x26d483(0x1ce),_0x26d483(0x24e),'Você\x20não\x20pode\x20enviar\x20mensagens\x20no\x20chat\x20de\x20outro\x20usuário.','my-2','ID\x20\x27',_0x26d483(0x1b1),_0x26d483(0x20d),'querySelector','gemini-','):\x20Requisição\x20inválida\x20(400).\x20Pode\x20ser\x20um\x20problema\x20no\x20histórico\x20ou\x20configuração.',_0x26d483(0x2cd),_0x26d483(0x1fe),_0x26d483(0x1a1),_0x26d483(0x1d8),_0x26d483(0x2aa),_0x26d483(0x264),'9cahPKk',_0x26d483(0x1c6),_0x26d483(0x295),_0x26d483(0x273),_0x26d483(0x231),'gemini',_0x26d483(0x28f),_0x26d483(0x1cd),_0x26d483(0x1ac),_0x26d483(0x2af),_0x26d483(0x239),'scrollHeight',_0x26d483(0x261),_0x26d483(0x246),_0x26d483(0x28c),_0x26d483(0x248),_0x26d483(0x1e6),_0x26d483(0x1c5),_0x26d483(0x2dc),_0x26d483(0x27d),'Listener\x20Firebase\x20desanexado\x20com\x20sucesso.',_0x26d483(0x275),'Usuário\x20\x27','replace',_0x26d483(0x1d1),_0x26d483(0x1d2),_0x26d483(0x23b),'Esse\x20nome\x20não\x20é\x20permitido.','Conectado\x20Firebase','userChats/',_0x26d483(0x25f),'</code></pre>',_0x26d483(0x217),_0x26d483(0x2d3),_0x26d483(0x2e0),_0x26d483(0x2b1),_0x26d483(0x236),'response',_0x26d483(0x228),'other',_0x26d483(0x21b),'\x27\x20parece\x20ser\x20um\x20ID.\x20Verificando\x20existência...',_0x26d483(0x24c),'forEach',_0x26d483(0x2a0),_0x26d483(0x2d7),_0x26d483(0x285),_0x26d483(0x1fb),_0x26d483(0x1d7),_0x26d483(0x265),_0x26d483(0x1c0),_0x26d483(0x1b8),_0x26d483(0x291),_0x26d483(0x1c1),_0x26d483(0x2ab),_0x26d483(0x29c),_0x26d483(0x2d5),_0x26d483(0x252),_0x26d483(0x2ba),'13320170oIwUAd',_0x26d483(0x2c6),_0x26d483(0x1a7),_0x26d483(0x1c2),_0x26d483(0x1bc),_0x26d483(0x27b),_0x26d483(0x1e7),'focus',_0x26d483(0x211),_0x26d483(0x286),_0x26d483(0x2e5),_0x26d483(0x206),_0x26d483(0x1e9),_0x26d483(0x21d),_0x26d483(0x2c5),_0x26d483(0x20b),_0x26d483(0x297),'blockReason',_0x26d483(0x2df),_0x26d483(0x2ed),_0x26d483(0x2e7),_0x26d483(0x1b7),_0x26d483(0x1d0),'limitToLast',_0x26d483(0x1fa),_0x26d483(0x2e1),_0x26d483(0x2eb),_0x26d483(0x22c),_0x26d483(0x2b6),_0x26d483(0x1a2),_0x26d483(0x250),_0x26d483(0x21e),_0x26d483(0x243),_0x26d483(0x281),_0x26d483(0x25e),'sort','SDK\x20Gemini\x20não\x20inicializado.',_0x26d483(0x208),_0x26d483(0x1af),_0x26d483(0x1f0),_0x26d483(0x1df),'btn-other-chat',_0x26d483(0x2d6),'map','Listener\x20Firebase\x20anexado\x20em\x20',_0x26d483(0x2a9),_0x26d483(0x244),'&amp;',_0x26d483(0x1f5),_0x26d483(0x2a1),'Resposta\x20recebida\x20de\x20Gemini\x20(','2-digit',_0x26d483(0x1f8),'innerHTML',_0x26d483(0x1d9),_0x26d483(0x2e4),'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20',_0x26d483(0x213),'number','<em>$1</em>','\x20px-3\x20py-2\x20max-w-[80%]\x20sm:max-w-[75%]\x20break-words\x20text-sm\x20sm:text-base\x20shadow-sm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>',_0x26d483(0x1f4),'Inicializando\x20chat\x20(',_0x26d483(0x227),'956218zMwBPw',_0x26d483(0x29d),'Erro\x20ao\x20inicializar\x20SDK\x20Gemini:',_0x26d483(0x234),'includes',_0x26d483(0x1a3),'\x20/\x20',_0x26d483(0x1a5),_0x26d483(0x254),_0x26d483(0x2bc),_0x26d483(0x2e8),_0x26d483(0x1ee),_0x26d483(0x1f1),'Erro\x20ao\x20buscar\x20username\x20no\x20Firebase:',_0x26d483(0x263),'Erro\x20crítico:\x20',_0x26d483(0x2d4),_0x26d483(0x20e),_0x26d483(0x209),_0x26d483(0x212),_0x26d483(0x249),_0x26d483(0x225),'Nova\x20mensagem\x20recebida\x20via\x20listener\x20(','add',_0x26d483(0x27e),'<div\x20class=\x22text-center\x20text-red-500\x20py-10\x20initial-message\x22><i\x20class=\x22fas\x20fa-user-slash\x20text-3xl\x20sm:text-4xl\x20mb-2\x22></i><p\x20class=\x22text-sm\x20sm:text-base\x22>Usuário\x20\x27',_0x26d483(0x1c7),_0x26d483(0x1cf),'scrollTop',_0x26d483(0x299),_0x26d483(0x2b9),'Mensagem\x20inválida\x20ou\x20sem\x20timestamp\x20encontrada\x20no\x20histórico:',_0x26d483(0x237),_0x26d483(0x1fc),_0x26d483(0x232),'Desconectado\x20do\x20Firebase...',_0x26d483(0x1b0),_0x26d483(0x26f),_0x26d483(0x268),_0x26d483(0x2dd),_0x26d483(0x1cb),_0x26d483(0x289),_0x26d483(0x2a2),'Enviando\x20para\x20Gemini\x20(','btn-general-chat',_0x26d483(0x2a6),_0x26d483(0x216),_0x26d483(0x27f),_0x26d483(0x25b),'startsWith',_0x26d483(0x2b0),_0x26d483(0x2c1),_0x26d483(0x2d2),_0x26d483(0x2ca),_0x26d483(0x2b2),'ServerValue',_0x26d483(0x1f6),_0x26d483(0x26e),_0x26d483(0x1be),_0x26d483(0x2b4),_0x26d483(0x2e2),_0x26d483(0x220),_0x26d483(0x1e3),_0x26d483(0x29b),_0x26d483(0x203),'length',_0x26d483(0x24d),_0x26d483(0x22f),_0x26d483(0x256),_0x26d483(0x1da),_0x26d483(0x28a),_0x26d483(0x24a),_0x26d483(0x245),_0x26d483(0x22b),_0x26d483(0x2c0),_0x26d483(0x200),'Não\x20foi\x20possível\x20identificar\x20o\x20usuário\x20\x27',_0x26d483(0x29f),'Erro\x20crítico:\x20SDK\x20Gemini\x20não\x20disponível\x20para\x20enviar\x20mensagem.',_0x26d483(0x26c),_0x26d483(0x2e9),'string',_0x26d483(0x2c2),_0x26d483(0x222),_0x26d483(0x1aa),_0x26d483(0x202),_0x26d483(0x28b),'bg-indigo-600\x20text-white\x20rounded-l-lg\x20rounded-tr-lg',_0x26d483(0x2ad),_0x26d483(0x1d5),_0x26d483(0x1ae),'Objeto\x20\x27chat\x27\x20não\x20inicializado\x20em\x20getGeminiResponse.',_0x26d483(0x1a4),_0x26d483(0x226),_0x26d483(0x293),'update',_0x26d483(0x1cc),'Nenhum\x20listener/ref\x20Firebase\x20anterior\x20para\x20desanexar\x20(ou\x20um\x20deles\x20era\x20null).\x20Ref:',_0x26d483(0x1e8),'\x20mensagens\x20no\x20histórico.',_0x26d483(0x1d6),_0x26d483(0x1b4),_0x26d483(0x22a),_0x26d483(0x221),_0x26d483(0x205),_0x26d483(0x1f3),_0x26d483(0x271),'filter',_0x26d483(0x21f),_0x26d483(0x284),_0x26d483(0x2ac),_0x26d483(0x279),_0x26d483(0x2e6),_0x26d483(0x251),_0x26d483(0x257),_0x26d483(0x25a),_0x26d483(0x2bf),'Erro\x20ao\x20tentar\x20desanexar\x20listener\x20Firebase:','toISOString',_0x26d483(0x269),_0x26d483(0x277),'ID\x20do\x20modelo\x20inválido\x20após\x20sanitização\x20para\x20salvar\x20resposta.','Tentativa\x20de\x20chamar\x20getGeminiResponse\x20em\x20view\x20inválida:','Erro\x20de\x20Permissão\x20ao\x20acessar\x20',_0x26d483(0x23a),_0x26d483(0x1ed),_0x26d483(0x210),_0x26d483(0x1f7),_0x26d483(0x207),_0x26d483(0x28d),_0x26d483(0x253),_0x26d483(0x2c9),_0x26d483(0x1b3),_0x26d483(0x1bf),_0x26d483(0x2cc),_0x26d483(0x1e2),'Modelo\x20selecionado:\x20',_0x26d483(0x1ea),_0x26d483(0x287),'placeholder',_0x26d483(0x1fd),'Gemini\x201.5\x20Flash',_0x26d483(0x28e),_0x26d483(0x2a5),_0x26d483(0x23c),_0x26d483(0x2a7),_0x26d483(0x2a3),_0x26d483(0x1ab),_0x26d483(0x2c8),'chat-view-button-active',_0x26d483(0x278),_0x26d483(0x24f),_0x26d483(0x1db),_0x26d483(0x2c4),_0x26d483(0x2d8),_0x26d483(0x1ec),_0x26d483(0x2b7),'getTime',_0x26d483(0x2ae),_0x26d483(0x240),'Erro:\x20O\x20chat\x20não\x20está\x20pronto\x20para\x20receber\x20mensagens.',_0x26d483(0x292)];return _0xe21a=function(){return _0x27dc34;},_0xe21a();}const _0x179245=_0x6c00;(function(_0x1482ed,_0x30a64b){const _0x152324=_0x5c4b,_0x5171de=_0x6c00,_0x89f127=_0x1482ed();while(!![]){try{const _0x275563=parseInt(_0x5171de(0xf5))/0x1+parseInt(_0x5171de(0x11f))/0x2+parseInt(_0x5171de(0x1fe))/0x3*(-parseInt(_0x5171de(0x149))/0x4)+-parseInt(_0x5171de(0xe8))/0x5+-parseInt(_0x5171de(0x20d))/0x6*(parseInt(_0x5171de(0x128))/0x7)+-parseInt(_0x5171de(0xe0))/0x8*(parseInt(_0x5171de(0x159))/0x9)+parseInt(_0x5171de(0xdf))/0xa*(parseInt(_0x5171de(0x231))/0xb);if(_0x275563===_0x30a64b)break;else _0x89f127[_0x152324(0x1ec)](_0x89f127['shift']());}catch(_0x123aa1){_0x89f127[_0x152324(0x1ec)](_0x89f127[_0x152324(0x2d9)]());}}}(_0xe21a,0x799ee));import{GoogleGenerativeAI}from'https://esm.run/@google/generative-ai@latest';const firebaseConfig={'apiKey':_0x179245(0xfb),'authDomain':_0x383c84(0x2b5),'projectId':_0x179245(0x1e6),'storageBucket':_0x179245(0x1c3),'messagingSenderId':_0x179245(0x230),'appId':_0x179245(0x1a6),'measurementId':_0x179245(0x191)},GEMINI_API_KEY=_0x179245(0x1df),AVAILABLE_MODELS=[{'id':_0x179245(0xfa),'name':_0x179245(0x1ac)}];let currentModelId=AVAILABLE_MODELS[0x0]['id'],currentChatView=_0x179245(0x1f3),targetChatId=null,USER_DEVICE_ID=null,USERNAME=null,genAI,chat=null,currentFirebaseListener=null,currentMessagesRef=null,isGeminiTyping=![],messageCounter=0x0,initialLoadComplete=![];try{firebase[_0x179245(0xef)](firebaseConfig);}catch(_0x361b0b){console[_0x179245(0x16a)]('Erro\x20ao\x20inicializar\x20Firebase:',_0x361b0b),alert(_0x179245(0x20e));}const database=firebase[_0x179245(0xf2)](),connectedRef=database[_0x179245(0x237)](_0x179245(0x15e));function _0x6c00(_0x560535,_0x165462){const _0x1e7dd7=_0xe21a();return _0x6c00=function(_0x31e8a2,_0x7be070){_0x31e8a2=_0x31e8a2-0xdf;let _0x3e7132=_0x1e7dd7[_0x31e8a2];return _0x3e7132;},_0x6c00(_0x560535,_0x165462);}try{if(!GEMINI_API_KEY||GEMINI_API_KEY===_0x179245(0x1c6))throw new Error(_0x383c84(0x1bb));genAI=new GoogleGenerativeAI(GEMINI_API_KEY);}catch(_0x12a870){console[_0x179245(0x16a)](_0x179245(0x121),_0x12a870),alert(_0x179245(0x12e)+_0x12a870[_0x179245(0x157)]+_0x179245(0x126));const messageInput=document[_0x179245(0x161)](_0x179245(0x146)),messageSubmitButton=document[_0x179245(0x1f5)]('#message-form\x20button[type=\x22submit\x22]');if(messageInput)messageInput[_0x179245(0xff)]=!![];if(messageSubmitButton)messageSubmitButton[_0x179245(0xff)]=!![];}const messageForm=document[_0x383c84(0x24d)](_0x179245(0x21e)),messageInput=document[_0x179245(0x161)](_0x179245(0x146)),messageSubmitButton=messageForm[_0x179245(0x1f5)](_0x179245(0x171)),chatMessages=document[_0x179245(0x161)](_0x179245(0xe3)),typingIndicator=document[_0x179245(0x161)](_0x179245(0x226)),statusIndicator=document[_0x179245(0x161)](_0x383c84(0x280)),statusText=document[_0x179245(0x161)](_0x179245(0x22e)),connectionStatus=document[_0x179245(0x161)](_0x179245(0x16e)),messageCount=document[_0x383c84(0x24d)](_0x179245(0x1d2)),modelSelect=document[_0x383c84(0x24d)](_0x383c84(0x20f)),deviceIdDisplay=document[_0x383c84(0x24d)](_0x179245(0x15f)),btnGeneralChat=document[_0x383c84(0x24d)](_0x179245(0x14b)),btnMyChat=document[_0x179245(0x161)](_0x179245(0x202)),btnOtherChat=document[_0x179245(0x161)](_0x179245(0x108)),userSearchInput=document[_0x179245(0x161)](_0x179245(0x140)),currentChatInfo=document[_0x383c84(0x24d)](_0x179245(0x22a)),welcomeModal=document[_0x179245(0x161)](_0x383c84(0x22e)),usernameInput=document[_0x179245(0x161)](_0x179245(0x115)),saveUsernameBtn=document[_0x179245(0x161)](_0x383c84(0x260)),usernameDisplay=document[_0x179245(0x161)](_0x179245(0x139)),usernameError=document[_0x179245(0x161)](_0x179245(0x221));function sanitizeForFirebasePath(_0x442316){const _0x1bc42c=_0x179245;if(!_0x442316)return'';return _0x442316[_0x1bc42c(0x215)](/[.#$[\]/]/g,'_');}function escapeHtml(_0xdce3a0){const _0x3b97e1=_0x383c84,_0x522a5d=_0x179245;if(typeof _0xdce3a0!==_0x522a5d(0x170))return'';return _0xdce3a0[_0x3b97e1(0x27a)](/&/g,_0x522a5d(0x10e))[_0x522a5d(0x215)](/</g,_0x3b97e1(0x22f))[_0x522a5d(0x215)](/>/g,_0x522a5d(0x1af))[_0x522a5d(0x215)](/"/g,_0x522a5d(0xea))[_0x522a5d(0x215)](/'/g,_0x522a5d(0x1fd));}function formatMarkdown(_0x1b4700){const _0x1130b9=_0x383c84,_0x39775e=_0x179245;if(typeof _0x1b4700!==_0x39775e(0x170))return'';let _0x1ed21c=_0x1b4700[_0x39775e(0x215)](/&/g,_0x39775e(0x10e))[_0x39775e(0x215)](/</g,_0x39775e(0x162))[_0x39775e(0x215)](/>/g,_0x1130b9(0x23c));const _0x2b51d1={};let _0x4c14ee=0x0;_0x1ed21c=_0x1ed21c[_0x1130b9(0x27a)](/```([\s\S]*?)```/gs,(_0x5835e1,_0x1d78cb)=>{const _0xf482b0=_0x39775e,_0x117949=_0xf482b0(0x1b1)+_0x4c14ee++ +'__';return _0x2b51d1[_0x117949]=_0xf482b0(0x143)+escapeHtml(_0x1d78cb)+_0xf482b0(0x21d),_0x117949;}),_0x1ed21c=_0x1ed21c[_0x39775e(0x215)](/\[([^\]]+)\]\(([^)]+)\)/g,_0x39775e(0x106)),_0x1ed21c=_0x1ed21c[_0x39775e(0x215)](/\*\*(.*?)\*\*/g,_0x39775e(0x174)),_0x1ed21c=_0x1ed21c[_0x1130b9(0x27a)](/(?<!\*)\*(?!\*)(.*?)(?<!\*)\*(?!\*)/g,_0x39775e(0x11a)),_0x1ed21c=_0x1ed21c[_0x39775e(0x215)](/`([^`]+)`/g,(_0x13f672,_0x110790)=>_0x39775e(0x224)+escapeHtml(_0x110790)+'</code>');const _0x53930e=_0x1ed21c[_0x39775e(0x1c4)]('\x0a');let _0x3b0be7=[],_0x3381e1=null;_0x53930e[_0x39775e(0x229)](_0x2d5552=>{const _0x11f885=_0x1130b9,_0x4da67f=_0x39775e,_0x4fb121=_0x2d5552[_0x11f885(0x2a4)](/^(\s*)([-*+])\s+(.*)/),_0x48cfa1=_0x2d5552[_0x11f885(0x2a4)](/^(\s*)(\d+\.)\s+(.*)/);if(_0x4fb121){if(_0x3381e1!=='ul'){if(_0x3381e1)_0x3b0be7[_0x4da67f(0x1ba)]('</'+_0x3381e1+'>');_0x3b0be7[_0x4da67f(0x1ba)](_0x4da67f(0x1d8)),_0x3381e1='ul';}_0x3b0be7[_0x4da67f(0x1ba)](_0x4da67f(0x1c5)+_0x4fb121[0x3]+_0x4da67f(0x14d));}else{if(_0x48cfa1){if(_0x3381e1!=='ol'){if(_0x3381e1)_0x3b0be7[_0x4da67f(0x1ba)]('</'+_0x3381e1+'>');_0x3b0be7[_0x11f885(0x1ec)](_0x4da67f(0x145)),_0x3381e1='ol';}_0x3b0be7[_0x11f885(0x1ec)](_0x11f885(0x23e)+_0x48cfa1[0x3]+_0x4da67f(0x14d));}else _0x3381e1&&(_0x3b0be7[_0x4da67f(0x1ba)]('</'+_0x3381e1+'>'),_0x3381e1=null),_0x3b0be7[_0x4da67f(0x1ba)](_0x2d5552);}}),_0x3381e1&&_0x3b0be7[_0x39775e(0x1ba)]('</'+_0x3381e1+'>'),_0x1ed21c=_0x3b0be7[_0x39775e(0x16c)]('\x0a');for(const _0xfb8983 in _0x2b51d1){_0x1ed21c=_0x1ed21c[_0x39775e(0x215)](_0xfb8983,()=>_0x2b51d1[_0xfb8983]);}const _0x576dce=_0x1ed21c[_0x39775e(0x1c4)](/\n\s*\n/)[_0x39775e(0x10a)](_0x38090d=>_0x38090d[_0x39775e(0x1a2)]())[_0x39775e(0x18a)](_0x3adc38=>_0x3adc38)[_0x39775e(0x10a)](_0x4f156e=>{const _0x3e7696=_0x1130b9,_0x1c3b77=_0x39775e;if(_0x4f156e[_0x3e7696(0x2a4)](/^<(ul|ol|pre|h[1-6]|li|blockquote)/))return _0x4f156e;return _0x1c3b77(0x14f)+_0x4f156e[_0x1c3b77(0x215)](/\n/g,_0x1c3b77(0x15d))+_0x3e7696(0x238);})[_0x39775e(0x16c)]('');return _0x576dce;}function formatTime(_0x5ea5f2){const _0x14e474=_0x383c84,_0x56aaa8=_0x179245;if(!_0x5ea5f2||typeof _0x5ea5f2!==_0x56aaa8(0x119))return'';try{const _0x1e1baa=new Date(_0x5ea5f2);if(isNaN(_0x1e1baa[_0x56aaa8(0x1bc)]()))return'';const _0xf9f02=new Date(),_0x11733f=_0x1e1baa[_0x56aaa8(0x1ae)]()===_0xf9f02['getDate']()&&_0x1e1baa[_0x14e474(0x1d6)]()===_0xf9f02[_0x56aaa8(0x183)]()&&_0x1e1baa['getFullYear']()===_0xf9f02['getFullYear']();return _0x11733f?_0x1e1baa[_0x56aaa8(0x14e)]([],{'hour':_0x56aaa8(0x112),'minute':_0x56aaa8(0x112)}):_0x1e1baa[_0x56aaa8(0x14e)]([],{'day':_0x56aaa8(0x112),'month':_0x56aaa8(0x112),'year':_0x56aaa8(0x112),'hour':_0x56aaa8(0x112),'minute':_0x14e474(0x1e5)});}catch(_0x2bbdeb){return console[_0x56aaa8(0x16a)](_0x56aaa8(0x18e),_0x2bbdeb,_0x5ea5f2),'';}}function scrollToBottom(){setTimeout(()=>{const _0x3a0323=_0x6c00;if(chatMessages)chatMessages[_0x3a0323(0x13b)]=chatMessages[_0x3a0323(0x209)];},0x64);}function _0x5c4b(_0x457396,_0x84bedf){const _0x35f008=_0x35f0();return _0x5c4b=function(_0x5c4b26,_0x41cc68){_0x5c4b26=_0x5c4b26-0x1a1;let _0x2b1e28=_0x35f008[_0x5c4b26];return _0x2b1e28;},_0x5c4b(_0x457396,_0x84bedf);}function updateMessageCountDisplay(){const _0xaccc3=_0x383c84,_0x245450=_0x179245;let _0x42ca96=currentModelId[_0x245450(0x215)](_0x245450(0x1d9),'')[_0x245450(0x215)](_0x245450(0x12d),_0x245450(0x204))[_0x245450(0x215)](_0x245450(0x1f6),'g-'),_0x279792='';if(currentChatView==='general')_0x279792=_0x245450(0x137);else{if(currentChatView===_0x245450(0x1cd))_0x279792='Meu';else{if(currentChatView===_0x245450(0x225)&&targetChatId)_0x279792=_0x245450(0x206)+targetChatId[_0x245450(0x15a)](0x0,0x6)+_0xaccc3(0x29a);else _0x279792='?';}}if(messageCount)messageCount[_0x245450(0x20a)]=messageCounter+_0x245450(0x211)+_0x279792+_0x245450(0x125)+_0x42ca96+')';}function updateChatInfoLabel(){const _0x55a478=_0x383c84,_0x2ec0a8=_0x179245;let _0x15b948=_0x55a478(0x21c);if(currentChatView===_0x2ec0a8(0x1f3))_0x15b948+=_0x55a478(0x1ad);else{if(currentChatView===_0x55a478(0x2d0))_0x15b948+=_0x2ec0a8(0x19b);else{if(currentChatView===_0x2ec0a8(0x225)&&targetChatId)_0x15b948+=_0x2ec0a8(0x1ed)+targetChatId[_0x2ec0a8(0x15a)](0x0,0x8)+_0x2ec0a8(0x1d1);else _0x15b948+=_0x2ec0a8(0x1e9);}}if(currentChatInfo)currentChatInfo[_0x2ec0a8(0x20a)]=_0x15b948;}function updateActiveButton(){const _0x39b772=_0x383c84,_0x329791=_0x179245;document[_0x329791(0x141)](_0x329791(0x190))[_0x329791(0x229)](_0x3e30ce=>{const _0x1d904b=_0x5c4b,_0x93575c=_0x329791;_0x3e30ce[_0x93575c(0x104)][_0x1d904b(0x2d4)](_0x93575c(0x1b4)),_0x3e30ce[_0x93575c(0x104)]['add'](_0x93575c(0xfe));});const _0x47918e=currentChatView===_0x329791(0x1f3)?_0x329791(0x14b):currentChatView===_0x39b772(0x2d0)?_0x329791(0x202):currentChatView===_0x39b772(0x2b3)?_0x329791(0x108):null;if(_0x47918e){const _0x211a9c=document[_0x329791(0x161)](_0x47918e);_0x211a9c&&(_0x211a9c[_0x329791(0x104)][_0x329791(0x136)](_0x329791(0x1b4)),_0x211a9c[_0x329791(0x104)]['remove'](_0x329791(0xfe)));}}function getOrCreateDeviceId(){const _0x48b0ce=_0x383c84,_0x490ce5=_0x179245;let _0x3a7cc7=localStorage[_0x490ce5(0x217)](_0x490ce5(0x236));return!_0x3a7cc7?(_0x3a7cc7=_0x48b0ce(0x1d5)+Date[_0x490ce5(0x208)]()+'-'+Math[_0x490ce5(0x22f)]()[_0x490ce5(0x14c)](0x24)[_0x490ce5(0x15a)](0x2,0x8),localStorage[_0x490ce5(0x107)](_0x48b0ce(0x2d5),_0x3a7cc7),console[_0x490ce5(0x168)](_0x490ce5(0x1b2),_0x3a7cc7)):console[_0x490ce5(0x168)](_0x490ce5(0x1bb),_0x3a7cc7),_0x3a7cc7;}function updateUserDisplay(){const _0x3cdf12=_0x383c84,_0x340eff=_0x179245;if(USERNAME&&usernameDisplay)usernameDisplay[_0x340eff(0x20a)]=USERNAME,usernameDisplay[_0x340eff(0x104)][_0x340eff(0x12f)](_0x340eff(0x173));else usernameDisplay&&(usernameDisplay[_0x3cdf12(0x261)]=_0x3cdf12(0x2be),usernameDisplay[_0x340eff(0x104)][_0x340eff(0x136)](_0x340eff(0x173)));if(USER_DEVICE_ID&&deviceIdDisplay){const _0x12c5c=USER_DEVICE_ID[_0x340eff(0x15a)](0x0,0x8)+_0x340eff(0x1d1);deviceIdDisplay[_0x340eff(0x20a)]=_0x12c5c,deviceIdDisplay[_0x340eff(0x12b)]=_0x340eff(0xed)+USER_DEVICE_ID;}}async function saveUserToFirebase(){const _0x348c34=_0x383c84,_0x40826f=_0x179245;if(!USER_DEVICE_ID||!USERNAME){console[_0x40826f(0x16a)](_0x40826f(0x222));return;}console[_0x348c34(0x22b)](_0x348c34(0x2c3)+USER_DEVICE_ID+_0x40826f(0x118)+USERNAME);const _0x572a83=database[_0x40826f(0x237)](_0x348c34(0x1ce)+USER_DEVICE_ID),_0x3025d9=database[_0x40826f(0x237)](_0x40826f(0x122)+USERNAME);try{await _0x572a83[_0x40826f(0x17e)]({'username':USERNAME,'lastActive':firebase[_0x40826f(0xf2)][_0x40826f(0x156)][_0x40826f(0x18b)]}),await _0x3025d9[_0x348c34(0x215)](USER_DEVICE_ID),console[_0x40826f(0x168)](_0x348c34(0x26b));}catch(_0x2b3884){console[_0x40826f(0x16a)](_0x40826f(0x233),_0x2b3884);}}function showWelcomeModal(){const _0x1c521d=_0x179245;if(welcomeModal){welcomeModal[_0x1c521d(0x104)][_0x1c521d(0x12f)](_0x1c521d(0x100));if(usernameInput)usernameInput[_0x1c521d(0xe6)]();}else console[_0x1c521d(0x16a)](_0x1c521d(0x19c));}async function handleSaveUsername(){const _0x38c693=_0x383c84,_0x3bd19f=_0x179245,_0x351fd7=usernameInput[_0x3bd19f(0x151)][_0x3bd19f(0x1a2)]()[_0x38c693(0x273)]();usernameError[_0x3bd19f(0x20a)]='';if(_0x351fd7[_0x3bd19f(0x160)]<0x3||_0x351fd7[_0x3bd19f(0x160)]>0xf){usernameError[_0x3bd19f(0x20a)]=_0x3bd19f(0x1c8);return;}if(!/^[a-z0-9]+(?:[_-]?[a-z0-9]+)*$/i[_0x3bd19f(0x124)](_0x351fd7)){usernameError[_0x3bd19f(0x20a)]=_0x3bd19f(0x144);return;}if([_0x3bd19f(0x21f),_0x3bd19f(0x203),_0x3bd19f(0x133),_0x3bd19f(0x1ce)][_0x3bd19f(0x123)](_0x351fd7)){usernameError[_0x3bd19f(0x20a)]=_0x3bd19f(0x219);return;}saveUsernameBtn[_0x3bd19f(0xff)]=!![],saveUsernameBtn[_0x3bd19f(0x20a)]=_0x38c693(0x276);try{const _0x19945e=await database['ref'](_0x3bd19f(0x122)+_0x351fd7)[_0x3bd19f(0x1d5)](_0x3bd19f(0x151));if(_0x19945e[_0x3bd19f(0x228)]()&&_0x19945e[_0x3bd19f(0x166)]()!==USER_DEVICE_ID){usernameError[_0x3bd19f(0x20a)]=_0x38c693(0x27c),saveUsernameBtn[_0x3bd19f(0xff)]=![],saveUsernameBtn[_0x38c693(0x261)]='Salvar\x20e\x20Entrar';return;}USERNAME=_0x351fd7,localStorage[_0x3bd19f(0x107)](_0x38c693(0x2d1),USERNAME);if(welcomeModal)welcomeModal[_0x3bd19f(0x104)][_0x38c693(0x214)](_0x3bd19f(0x100));updateUserDisplay(),await saveUserToFirebase(),console[_0x3bd19f(0x168)](_0x38c693(0x291)+USERNAME+_0x3bd19f(0x1f4)),initialLoadComplete=!![],loadChatHistoryAndInit();}catch(_0x5502b6){console[_0x38c693(0x200)]('Erro\x20ao\x20verificar/salvar\x20nome\x20de\x20usuário:',_0x5502b6),usernameError[_0x3bd19f(0x20a)]=_0x3bd19f(0x130),saveUsernameBtn[_0x3bd19f(0xff)]=![],saveUsernameBtn[_0x3bd19f(0x20a)]=_0x3bd19f(0xf8);}}async function setupUser(){const _0x5dfa0b=_0x383c84,_0xe6ecca=_0x179245;USER_DEVICE_ID=getOrCreateDeviceId();const _0x193a17=localStorage[_0xe6ecca(0x217)](_0x5dfa0b(0x2d1));updateUserDisplay(),!_0x193a17?(console[_0xe6ecca(0x168)](_0xe6ecca(0x1dc)),showWelcomeModal()):(USERNAME=_0x193a17,console[_0xe6ecca(0x168)](_0xe6ecca(0x1c2)+USERNAME),updateUserDisplay(),await saveUserToFirebase(),initialLoadComplete=!![],loadChatHistoryAndInit());}async function initGeminiChat(_0x2b48a4=[],_0x615bd6){const _0x49c36b=_0x383c84,_0xffc6fe=_0x179245;chat=null;if(currentChatView!==_0xffc6fe(0x1f3)&&currentChatView!==_0xffc6fe(0x1cd))return console[_0xffc6fe(0x168)](_0xffc6fe(0x1d4),currentChatView),enableChatInput(![]),![];if(!genAI)return console[_0xffc6fe(0x16a)](_0xffc6fe(0x103)),appendSystemMessage(_0xffc6fe(0x154),_0x49c36b(0x200)),![];if(!_0x615bd6)return console[_0xffc6fe(0x16a)](_0xffc6fe(0x13f)),appendSystemMessage(_0xffc6fe(0x186),_0xffc6fe(0x16a)),![];appendSystemMessage(_0xffc6fe(0x11d)+currentChatView+_0xffc6fe(0x17c)+_0x615bd6+_0xffc6fe(0x1d1)),enableChatInput(![]);try{console[_0xffc6fe(0x168)](_0xffc6fe(0x1cc)+_0x615bd6+_0xffc6fe(0xe4)+currentChatView);const _0xc2f687=genAI[_0xffc6fe(0x1ab)]({'model':_0x615bd6});return chat=_0xc2f687[_0x49c36b(0x2db)]({'history':_0x2b48a4,'generationConfig':{'maxOutputTokens':0x7d0}}),console[_0xffc6fe(0x168)](_0xffc6fe(0x148)+_0x615bd6+_0xffc6fe(0x213)+currentChatView+_0xffc6fe(0x113)+_0x2b48a4[_0x49c36b(0x1a9)]+_0xffc6fe(0x182)),appendSystemMessage(_0xffc6fe(0x148)+currentChatView+_0xffc6fe(0x1de)),enableChatInput(!![]),!![];}catch(_0x26a377){console[_0xffc6fe(0x16a)](_0xffc6fe(0x10d)+_0x615bd6+_0x49c36b(0x275)+currentChatView+'):',_0x26a377);let _0x37c7ce=_0x49c36b(0x224)+currentChatView+_0xffc6fe(0x17c)+_0x615bd6+'.';if(_0x26a377[_0xffc6fe(0x157)]?.[_0xffc6fe(0x123)](_0xffc6fe(0x12a)))_0x37c7ce=_0xffc6fe(0x20f)+_0x615bd6+_0xffc6fe(0x1c1);else{if(_0x26a377[_0x49c36b(0x1f6)]?.[_0xffc6fe(0x123)](_0xffc6fe(0x1a0))||_0x26a377[_0xffc6fe(0x157)]?.['includes'](_0x49c36b(0x29d)))_0x37c7ce=_0xffc6fe(0x20f)+_0x615bd6+_0xffc6fe(0x1d6);else{if(_0x26a377[_0x49c36b(0x1f6)]?.['includes'](_0xffc6fe(0x13a)))_0x37c7ce=_0x49c36b(0x1c5)+_0x615bd6+_0x49c36b(0x241);else{if(_0x26a377[_0x49c36b(0x1f6)]?.[_0xffc6fe(0x123)](_0xffc6fe(0x205)))_0x37c7ce=_0xffc6fe(0x20f)+_0x615bd6+_0xffc6fe(0x1f7);else _0x26a377[_0xffc6fe(0x157)]?.[_0xffc6fe(0x123)](_0xffc6fe(0x109))||_0x26a377[_0xffc6fe(0x157)]?.[_0xffc6fe(0x123)](_0xffc6fe(0x101))||_0x26a377[_0xffc6fe(0x157)]?.[_0xffc6fe(0x123)](_0xffc6fe(0x235))?_0x37c7ce=_0xffc6fe(0x20f)+_0x615bd6+_0xffc6fe(0x134):_0x37c7ce='Falha\x20('+_0x615bd6+_0xffc6fe(0x13d)+(_0x26a377[_0xffc6fe(0x157)]||_0x49c36b(0x242));}}}return appendSystemMessage(_0x37c7ce,_0x49c36b(0x200)),enableChatInput(![]),![];}}function appendMessage(_0x43b525,_0x38820b=!![],_0x1962fb=null){const _0x41efe5=_0x383c84,_0x302110=_0x179245;if(!_0x43b525||typeof _0x43b525[_0x302110(0x1b8)]!==_0x302110(0x170)||!chatMessages)return;const _0x10d1b0=chatMessages[_0x302110(0x1f5)](_0x41efe5(0x1d3));if(_0x10d1b0)_0x10d1b0[_0x302110(0x12f)]();const _0x8a8b63=document[_0x302110(0x207)](_0x41efe5(0x2e6));if(_0x38820b)_0x8a8b63[_0x302110(0x104)][_0x302110(0x136)](_0x302110(0x1e5));if(_0x1962fb)_0x8a8b63['id']=_0x302110(0x218)+_0x1962fb;const _0x49d480=_0x43b525[_0x41efe5(0x2c4)],_0x3b8160=_0x43b525[_0x302110(0x1e4)]?formatTime(_0x43b525[_0x302110(0x1e4)]):'',_0x52567d=_0x43b525[_0x302110(0x1ef)]||null;if(_0x43b525[_0x302110(0x1db)]===_0x302110(0x116)){const _0x6ca9eb=_0x52567d===USER_DEVICE_ID,_0x56534f=_0x6ca9eb?_0x302110(0x1eb):_0x41efe5(0x2bb),_0x51c271=_0x6ca9eb?_0x302110(0x176):_0x302110(0x1b7),_0x3bddf7=!_0x6ca9eb&&_0x52567d&&(currentChatView===_0x41efe5(0x1b1)||currentChatView===_0x302110(0x225)),_0x533c8e=_0x3bddf7?_0x302110(0x1ca)+_0x52567d+'\x22>'+_0x52567d[_0x302110(0x15a)](0x0,0x6)+_0x41efe5(0x259):'';_0x8a8b63[_0x302110(0x114)]=_0x41efe5(0x235)+_0x56534f+_0x302110(0x153)+_0x51c271+_0x302110(0x11b)+escapeHtml(_0x49d480)+'\x20'+_0x533c8e+_0x302110(0x117)+(_0x6ca9eb?_0x302110(0x1fc):_0x302110(0xec))+_0x302110(0x1d0)+_0x3b8160+_0x302110(0x17b);}else{const _0x3516ce=formatMarkdown(_0x49d480),_0x3fa67b=_0x43b525['isError']||_0x49d480[_0x41efe5(0x273)]()[_0x302110(0x150)]('erro')||_0x49d480[_0x302110(0x201)]()[_0x41efe5(0x2bd)](_0x302110(0x19d))||_0x49d480[_0x302110(0x201)]()[_0x41efe5(0x2bd)](_0x41efe5(0x26a))||_0x49d480[_0x302110(0x201)]()[_0x302110(0x123)](_0x41efe5(0x2a8)),_0x1fb0b9=_0x3fa67b?_0x302110(0xf1):_0x302110(0xf7);_0x8a8b63[_0x302110(0x114)]=_0x302110(0x210)+_0x1fb0b9+_0x302110(0x147)+_0x3516ce+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-1\x22>'+_0x3b8160+_0x302110(0x17b);}chatMessages[_0x302110(0x1b9)](_0x8a8b63),scrollToBottom();}function appendSystemMessage(_0x48aaa8,_0x500408=_0x179245(0x1e8)){const _0x359489=_0x383c84,_0x32413a=_0x179245;if(!chatMessages)return;const _0x41b6e0=chatMessages[_0x32413a(0x1f5)](_0x32413a(0x1e0));if(_0x41b6e0)_0x41b6e0[_0x32413a(0x12f)]();const _0x1f4ff7=document[_0x359489(0x2af)](_0x32413a(0x18f));_0x1f4ff7[_0x32413a(0x104)][_0x32413a(0x136)](_0x32413a(0x1e5),_0x32413a(0x179),_0x32413a(0x238),_0x32413a(0x1f1));let _0x273e8a=_0x32413a(0x16f);if(_0x500408===_0x32413a(0x16a))_0x273e8a=_0x359489(0x2df);else _0x500408===_0x32413a(0x197)&&(_0x273e8a=_0x32413a(0x155));_0x1f4ff7[_0x359489(0x258)]=_0x359489(0x1f9)+_0x273e8a+_0x32413a(0x22b)+escapeHtml(_0x48aaa8)+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',chatMessages[_0x32413a(0x1b9)](_0x1f4ff7),scrollToBottom();}async function getGeminiResponse(_0x12488c){const _0x20b660=_0x383c84,_0x5d2b05=_0x179245;if(currentChatView!==_0x20b660(0x1b1)&&currentChatView!==_0x20b660(0x2d0)){console[_0x20b660(0x272)](_0x5d2b05(0x199),currentChatView);return;}if(!chat){console[_0x5d2b05(0x16a)](_0x5d2b05(0x17a)),appendSystemMessage(_0x5d2b05(0x1bf),_0x5d2b05(0x16a)),enableChatInput(!![]);return;}if(!genAI){console[_0x5d2b05(0x16a)](_0x5d2b05(0x103)),appendSystemMessage(_0x5d2b05(0x154),_0x5d2b05(0x16a)),enableChatInput(!![]);return;}isGeminiTyping=!![];if(typingIndicator)typingIndicator[_0x20b660(0x208)][_0x20b660(0x2d4)](_0x20b660(0x281));scrollToBottom();const _0x1ca3bb=sanitizeForFirebasePath(currentModelId);if(!_0x1ca3bb){console[_0x5d2b05(0x16a)](_0x5d2b05(0x198)),appendSystemMessage(_0x20b660(0x1ca),'error'),isGeminiTyping=![];if(typingIndicator)typingIndicator[_0x5d2b05(0x104)][_0x5d2b05(0x136)]('hidden');enableChatInput(!![]);return;}let _0x4d3cd2=null;if(currentChatView===_0x5d2b05(0x1f3))_0x4d3cd2=_0x20b660(0x2e3)+_0x1ca3bb;else currentChatView===_0x5d2b05(0x1cd)&&USER_DEVICE_ID&&(_0x4d3cd2=_0x5d2b05(0x21b)+USER_DEVICE_ID+'/'+_0x1ca3bb);if(!_0x4d3cd2){console[_0x5d2b05(0x16a)]('Não\x20foi\x20possível\x20determinar\x20o\x20caminho\x20para\x20salvar\x20a\x20resposta\x20do\x20Gemini.'),appendSystemMessage(_0x5d2b05(0x132),_0x5d2b05(0x16a)),isGeminiTyping=![];if(typingIndicator)typingIndicator[_0x5d2b05(0x104)][_0x5d2b05(0x136)](_0x5d2b05(0x100));enableChatInput(!![]);return;}try{console[_0x5d2b05(0x168)](_0x5d2b05(0x14a)+currentModelId+_0x20b660(0x275)+currentChatView+'):',_0x12488c);const _0x1e4544=await chat['sendMessage'](_0x12488c),_0x45314a=await _0x1e4544[_0x20b660(0x1b2)],_0x209f85=_0x45314a[_0x5d2b05(0x1b8)]();console[_0x5d2b05(0x168)](_0x5d2b05(0x111)+currentModelId+_0x5d2b05(0x213)+currentChatView+'):',_0x209f85);const _0x294544=database[_0x20b660(0x252)](_0x4d3cd2)[_0x5d2b05(0x1ba)]();await _0x294544[_0x5d2b05(0x1d7)]({'text':_0x209f85,'sender':_0x5d2b05(0x203),'timestamp':firebase[_0x5d2b05(0xf2)][_0x5d2b05(0x156)][_0x20b660(0x21f)],'deviceId':null,'isError':![]}),console[_0x5d2b05(0x168)](_0x20b660(0x229),_0x294544[_0x5d2b05(0x17f)]);}catch(_0x4fcc57){console[_0x5d2b05(0x16a)](_0x20b660(0x2de)+currentModelId+_0x5d2b05(0x213)+currentChatView+'):',_0x4fcc57);let _0x5a3bb0=_0x5d2b05(0xf9)+currentModelId+'.',_0x2c07f1=!![];if(_0x4fcc57[_0x20b660(0x1b2)]?.['promptFeedback']?.[_0x5d2b05(0xf0)])_0x5a3bb0=_0x5d2b05(0x163)+currentModelId+'\x20devido\x20a:\x20'+_0x4fcc57[_0x5d2b05(0x223)][_0x20b660(0x267)][_0x5d2b05(0xf0)]+'.';else{if(_0x4fcc57[_0x5d2b05(0x157)]?.[_0x5d2b05(0x123)](_0x20b660(0x29c))||_0x4fcc57[_0x5d2b05(0x157)]?.[_0x5d2b05(0x123)](_0x5d2b05(0x109)))_0x5a3bb0=_0x5d2b05(0xe5)+currentModelId+_0x5d2b05(0x1f9);else{if(_0x4fcc57[_0x5d2b05(0x157)]?.[_0x20b660(0x25d)](_0x5d2b05(0x12a)))_0x5a3bb0=_0x5d2b05(0xe5)+currentModelId+_0x5d2b05(0x18d),_0x2c07f1=![];else{if(_0x4fcc57[_0x20b660(0x1f6)]?.[_0x5d2b05(0x123)](_0x5d2b05(0x1a0))||_0x4fcc57[_0x5d2b05(0x157)]?.[_0x5d2b05(0x123)](_0x5d2b05(0x120)))_0x5a3bb0=_0x5d2b05(0x189)+currentModelId+_0x5d2b05(0x1d3);else _0x4fcc57[_0x5d2b05(0x157)]&&(_0x5a3bb0=_0x5d2b05(0x110)+currentModelId+'):\x20'+_0x4fcc57[_0x20b660(0x1f6)]);}}}const _0x3450d3=database[_0x20b660(0x252)](_0x4d3cd2)[_0x5d2b05(0x1ba)]();await _0x3450d3[_0x5d2b05(0x1d7)]({'text':_0x5a3bb0,'sender':_0x5d2b05(0x203),'timestamp':firebase[_0x5d2b05(0xf2)][_0x20b660(0x23d)][_0x5d2b05(0x18b)],'deviceId':null,'isError':!![]}),console[_0x5d2b05(0x168)](_0x5d2b05(0x1e3),_0x3450d3[_0x5d2b05(0x17f)]);}finally{isGeminiTyping=![];if(typingIndicator)typingIndicator[_0x5d2b05(0x104)][_0x5d2b05(0x136)](_0x5d2b05(0x100));enableChatInput(!![]);}}function enableChatInput(_0x158d60){const _0xa8b0f9=_0x383c84,_0xdbbde9=_0x179245,_0x130acc=statusText[_0xa8b0f9(0x261)]===_0xdbbde9(0xf3),_0x3df3d6=_0x158d60&&(currentChatView===_0xdbbde9(0x1f3)||currentChatView===_0xdbbde9(0x1cd))&&!!chat&&!isGeminiTyping&&_0x130acc;if(messageInput){messageInput[_0xdbbde9(0xff)]=!_0x3df3d6,messageInput[_0xdbbde9(0x104)][_0xdbbde9(0x19e)](_0xdbbde9(0x196),!_0x3df3d6),messageInput[_0xdbbde9(0x104)][_0xdbbde9(0x19e)](_0xdbbde9(0x127),!_0x3df3d6);if(!_0x130acc)messageInput[_0xdbbde9(0x1aa)]=_0xdbbde9(0x142);else{if(currentChatView===_0xdbbde9(0x225))messageInput[_0xa8b0f9(0x1dd)]=_0xdbbde9(0x11c);else{if(!chat&&(currentChatView===_0xa8b0f9(0x1b1)||currentChatView===_0xdbbde9(0x1cd)))messageInput[_0xdbbde9(0x1aa)]=_0xdbbde9(0x1a1);else{if(isGeminiTyping)messageInput['placeholder']=_0xdbbde9(0xfc);else!_0x3df3d6?messageInput[_0xdbbde9(0x1aa)]=_0xdbbde9(0x1e1):messageInput[_0xdbbde9(0x1aa)]=_0xdbbde9(0x18c);}}}}messageSubmitButton&&(messageSubmitButton[_0xa8b0f9(0x243)]=!_0x3df3d6,messageSubmitButton[_0xdbbde9(0x104)][_0xa8b0f9(0x1f7)](_0xdbbde9(0x192),!_0x3df3d6),messageSubmitButton[_0xdbbde9(0x104)]['toggle'](_0xdbbde9(0x127),!_0x3df3d6));}async function loadChatHistoryAndInit(){const _0x88e722=_0x383c84,_0x2f2b36=_0x179245;if(!initialLoadComplete){console[_0x2f2b36(0x168)](_0x88e722(0x2cf));if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x2f2b36(0x1ad);return;}console[_0x2f2b36(0x168)](_0x88e722(0x298)+currentChatView+_0x2f2b36(0x1fa)+currentModelId+_0x2f2b36(0x172)+(targetChatId||(currentChatView===_0x2f2b36(0x1f3)?_0x2f2b36(0x137):_0x2f2b36(0x17d)))+'\x27'),enableChatInput(![]);if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x2f2b36(0x158);messageCounter=0x0,updateMessageCountDisplay(),updateChatInfoLabel(),updateActiveButton();if(currentMessagesRef&&currentFirebaseListener){console[_0x2f2b36(0x168)](_0x2f2b36(0x105),currentMessagesRef[_0x2f2b36(0x14c)]());try{currentMessagesRef[_0x2f2b36(0x11e)](_0x2f2b36(0x1ff),currentFirebaseListener),console[_0x88e722(0x22b)](_0x2f2b36(0x212));}catch(_0x5ce59f){console[_0x2f2b36(0x16a)](_0x2f2b36(0x194),_0x5ce59f);}}else console[_0x2f2b36(0x168)](_0x2f2b36(0x180),currentMessagesRef,'Listener:',typeof currentFirebaseListener);currentFirebaseListener=null,currentMessagesRef=null,chat=null,targetChatId=currentChatView===_0x2f2b36(0x225)?targetChatId:null;let _0x1e36ed=null;const _0x5347f3=sanitizeForFirebasePath(currentModelId);if(!_0x5347f3){const _0x4ed7a3=_0x2f2b36(0x193);console['error'](_0x4ed7a3),appendSystemMessage(_0x4ed7a3,_0x2f2b36(0x16a));if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x88e722(0x22d)+_0x4ed7a3+_0x2f2b36(0x1dd);return;}if(currentChatView===_0x2f2b36(0x1f3))_0x1e36ed=_0x2f2b36(0x1e7)+_0x5347f3;else{if(currentChatView===_0x2f2b36(0x1cd)&&USER_DEVICE_ID)_0x1e36ed=_0x2f2b36(0x21b)+USER_DEVICE_ID+'/'+_0x5347f3;else{if(currentChatView===_0x88e722(0x2b3)){const _0x4606b0=userSearchInput[_0x2f2b36(0x151)][_0x2f2b36(0x1a2)]();if(!_0x4606b0){appendSystemMessage(_0x2f2b36(0x22c),_0x2f2b36(0x1e8));if(chatMessages)chatMessages[_0x88e722(0x258)]=_0x2f2b36(0x13c);enableChatInput(![]);return;}appendSystemMessage(_0x2f2b36(0x1a9)+_0x4606b0+_0x2f2b36(0x1d1),_0x88e722(0x218));let _0x135893=null;if(!_0x4606b0[_0x2f2b36(0x150)](_0x2f2b36(0x178))){const _0x50a653=_0x4606b0[_0x2f2b36(0x201)]();try{const _0x5b9f3b=await database[_0x2f2b36(0x237)](_0x2f2b36(0x122)+_0x50a653)[_0x2f2b36(0x1d5)](_0x88e722(0x2b0));_0x5b9f3b[_0x2f2b36(0x228)]()?(_0x135893=_0x5b9f3b[_0x88e722(0x24a)](),console[_0x2f2b36(0x168)](_0x2f2b36(0x232)+_0x4606b0+'\x27\x20encontrado.\x20ID:\x20'+_0x135893)):console[_0x2f2b36(0x168)](_0x2f2b36(0x232)+_0x4606b0+_0x2f2b36(0x20c));}catch(_0x2acc1e){console[_0x2f2b36(0x16a)](_0x2f2b36(0x12c),_0x2acc1e),appendSystemMessage(_0x2f2b36(0xe9)+_0x4606b0+'\x27.',_0x88e722(0x200));}}if(!_0x135893){if(_0x4606b0['startsWith'](_0x2f2b36(0x178)))_0x135893=_0x4606b0,console[_0x2f2b36(0x168)](_0x2f2b36(0x167)+_0x4606b0+_0x2f2b36(0x227));else{appendSystemMessage(_0x2f2b36(0x214)+_0x4606b0+_0x88e722(0x2b8),_0x2f2b36(0x16a));if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x2f2b36(0x138)+escapeHtml(_0x4606b0)+_0x2f2b36(0x1c7);enableChatInput(![]);return;}}if(_0x135893)try{const _0x6c6e8b=await database['ref'](_0x2f2b36(0x1ee)+_0x135893)[_0x2f2b36(0x1d5)](_0x88e722(0x2b0));if(!_0x6c6e8b[_0x2f2b36(0x228)]()){console[_0x2f2b36(0x1cf)](_0x2f2b36(0x1f2)+_0x135893+_0x88e722(0x1e4)),appendSystemMessage(_0x2f2b36(0x1c9)+_0x135893[_0x2f2b36(0x15a)](0x0,0x8)+_0x2f2b36(0x164),_0x2f2b36(0x16a));if(chatMessages)chatMessages[_0x88e722(0x258)]=_0x2f2b36(0x1fb);enableChatInput(![]);return;}else targetChatId=_0x135893,_0x1e36ed=_0x2f2b36(0x21b)+targetChatId+'/'+_0x5347f3,console[_0x88e722(0x22b)]('Visualizando\x20chat\x20para\x20ID:\x20'+targetChatId),appendSystemMessage(_0x2f2b36(0x20b)+targetChatId+'\x27.',_0x88e722(0x218));}catch(_0x2a384b){console[_0x2f2b36(0x16a)](_0x2f2b36(0x10c)+_0x135893+':',_0x2a384b),appendSystemMessage(_0x2f2b36(0x1a8),_0x2f2b36(0x16a)),enableChatInput(![]);return;}else{appendSystemMessage(_0x2f2b36(0x16b)+_0x4606b0+'\x27.',_0x2f2b36(0x16a));if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x2f2b36(0x1c0);enableChatInput(![]);return;}}}}if(!_0x1e36ed){const _0x2d7453=currentChatView===_0x2f2b36(0x1cd)&&!USER_DEVICE_ID?_0x88e722(0x1e1):_0x2f2b36(0xfd);console[_0x2f2b36(0x16a)](_0x2d7453),appendSystemMessage(_0x2d7453,_0x2f2b36(0x16a));if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x88e722(0x22d)+_0x2d7453+_0x2f2b36(0x1dd);enableChatInput(![]);return;}currentMessagesRef=database[_0x2f2b36(0x237)](_0x1e36ed),console[_0x2f2b36(0x168)](_0x88e722(0x274)+_0x1e36ed);try{const _0x15a83e=await currentMessagesRef[_0x2f2b36(0x185)](_0x2f2b36(0x1e4))[_0x2f2b36(0xf6)](0x32)[_0x88e722(0x1c8)](_0x2f2b36(0x151)),_0x1a583b=_0x15a83e[_0x2f2b36(0x166)](),_0xb8f473=[];let _0x2b319c=0x0;if(chatMessages)chatMessages[_0x2f2b36(0x114)]='';if(_0x1a583b){console[_0x2f2b36(0x168)](_0x88e722(0x1bd)+currentChatView+':\x20'+Object[_0x88e722(0x20c)](_0x1a583b)[_0x2f2b36(0x160)]+_0x88e722(0x290));const _0x4d6308=Object[_0x88e722(0x20c)](_0x1a583b)[_0x2f2b36(0x102)]((_0x10ab94,_0x16d0bb)=>_0x1a583b[_0x10ab94][_0x2f2b36(0x1e4)]-_0x1a583b[_0x16d0bb][_0x2f2b36(0x1e4)]);_0x4d6308[_0x2f2b36(0x229)](_0x166d74=>{const _0x3e82b9=_0x88e722,_0x9f3984=_0x2f2b36;messageCounter++;const _0x5a8786=_0x1a583b[_0x166d74];if(_0x5a8786&&_0x5a8786[_0x9f3984(0x1e4)]){appendMessage(_0x5a8786,![],_0x166d74),_0x2b319c=Math[_0x3e82b9(0x1ef)](_0x2b319c,_0x5a8786[_0x9f3984(0x1e4)]);if((currentChatView===_0x9f3984(0x1f3)||currentChatView===_0x9f3984(0x1cd))&&typeof _0x5a8786[_0x9f3984(0x1b8)]===_0x9f3984(0x170)&&!_0x5a8786[_0x9f3984(0x1da)]){const _0xee379f=_0x5a8786[_0x9f3984(0x1db)]===_0x3e82b9(0x2e4)?_0x9f3984(0x116):_0x9f3984(0x1b6),_0x52792e=_0x5a8786[_0x9f3984(0x1b8)];_0x52792e[_0x3e82b9(0x2c9)]()?_0xb8f473[_0x9f3984(0x1ba)]({'role':_0xee379f,'parts':[{'text':_0x52792e}]}):console[_0x9f3984(0x1cf)](_0x9f3984(0x165),_0x166d74);}}else console[_0x9f3984(0x1cf)](_0x9f3984(0x13e),_0x166d74,_0x5a8786);});if(_0x4d6308[_0x2f2b36(0x160)]===0x0){if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x2f2b36(0xeb);}}else{console[_0x2f2b36(0x168)](_0x88e722(0x20a)+_0x1e36ed+'.');if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x2f2b36(0xeb);}updateMessageCountDisplay(),scrollToBottom();let _0x139efa=![];currentChatView==='general'||currentChatView===_0x2f2b36(0x1cd)?_0x139efa=await initGeminiChat(_0xb8f473,currentModelId):(_0x139efa=!![],console[_0x88e722(0x22b)](_0x2f2b36(0x1b3)),enableChatInput(![]));if(_0x139efa&&currentMessagesRef){currentFirebaseListener=_0x1edc07=>{const _0x230f9b=_0x88e722,_0x38a529=_0x2f2b36,_0x1ccc7b=_0x1edc07[_0x230f9b(0x24a)](),_0x423a88=_0x1edc07[_0x38a529(0x17f)];if(_0x1ccc7b&&!document[_0x38a529(0x161)](_0x38a529(0x218)+_0x423a88)){console['log'](_0x38a529(0x135)+currentChatView+'):',_0x423a88),messageCounter++,appendMessage(_0x1ccc7b,!![],_0x423a88),updateMessageCountDisplay();if(chat&&(_0x1ccc7b[_0x38a529(0x1db)]===_0x38a529(0x116)||_0x1ccc7b[_0x38a529(0x1db)]===_0x38a529(0x203))&&typeof _0x1ccc7b[_0x38a529(0x1b8)]===_0x38a529(0x170)&&!_0x1ccc7b[_0x38a529(0x1da)]){const _0x293323=_0x1ccc7b[_0x38a529(0x1db)]===_0x230f9b(0x2e4)?_0x38a529(0x116):_0x38a529(0x1b6);if(_0x1ccc7b[_0x38a529(0x1b8)][_0x38a529(0x1a2)]()){}}}else{if(!_0x1ccc7b)console[_0x230f9b(0x272)](_0x230f9b(0x1b9),_0x423a88);else{}}};const _0x20e8de=_0x2b319c>0x0?_0x2b319c+0x1:Date[_0x2f2b36(0x208)]();currentMessagesRef[_0x2f2b36(0x185)](_0x2f2b36(0x1e4))['startAt'](_0x20e8de)['on'](_0x2f2b36(0x1ff),currentFirebaseListener),console[_0x2f2b36(0x168)](_0x2f2b36(0x10b)+_0x1e36ed+_0x2f2b36(0x19f)+new Date(_0x20e8de)[_0x2f2b36(0x195)]()),currentChatView!==_0x88e722(0x2b3)&&enableChatInput(_0x139efa);}else console[_0x2f2b36(0x1cf)](_0x2f2b36(0x169)),!_0x139efa&&(currentChatView===_0x2f2b36(0x1f3)||currentChatView===_0x88e722(0x2d0))&&appendSystemMessage(_0x2f2b36(0xf4),_0x88e722(0x200)),enableChatInput(![]);}catch(_0x4aebed){console[_0x88e722(0x200)](_0x2f2b36(0x184)+_0x1e36ed+':',_0x4aebed);let _0x5817e2=_0x2f2b36(0x131);_0x4aebed[_0x2f2b36(0x157)]?.[_0x2f2b36(0x201)]()[_0x2f2b36(0x123)](_0x2f2b36(0x1cb))||_0x4aebed[_0x2f2b36(0x216)]?.[_0x2f2b36(0x201)]()[_0x2f2b36(0x123)](_0x88e722(0x2ea))?(_0x5817e2=_0x2f2b36(0x19a)+_0x1e36ed+_0x2f2b36(0x1bd),currentChatView===_0x2f2b36(0x225)&&(_0x5817e2+=_0x2f2b36(0x1b0))):_0x5817e2+=_0x2f2b36(0x177)+_0x4aebed[_0x2f2b36(0x157)],appendSystemMessage(_0x5817e2,_0x2f2b36(0x16a));if(chatMessages)chatMessages[_0x2f2b36(0x114)]=_0x88e722(0x1b5);enableChatInput(![]);}}function populateModelSelector(){const _0x4b3ea9=_0x179245;if(!modelSelect)return;modelSelect[_0x4b3ea9(0x114)]='',AVAILABLE_MODELS[_0x4b3ea9(0x229)](_0x41f396=>{const _0x5e227c=_0x4b3ea9,_0x36b036=document[_0x5e227c(0x207)](_0x5e227c(0x1a5));_0x36b036[_0x5e227c(0x151)]=_0x41f396['id'],_0x36b036[_0x5e227c(0x20a)]=_0x41f396[_0x5e227c(0x200)],_0x41f396['id']===currentModelId&&(_0x36b036[_0x5e227c(0xe1)]=!![]),modelSelect[_0x5e227c(0x1b9)](_0x36b036);});}connectedRef['on'](_0x179245(0x151),_0x2141c1=>{const _0x39b413=_0x383c84,_0xc72060=_0x179245,_0x616fb9=_0x2141c1[_0xc72060(0x166)]();console[_0xc72060(0x168)](_0xc72060(0x181),_0x616fb9),statusIndicator&&(statusIndicator[_0xc72060(0x104)][_0xc72060(0x19e)](_0xc72060(0xee),_0x616fb9),statusIndicator[_0xc72060(0x104)][_0x39b413(0x1f7)](_0xc72060(0x10f),!_0x616fb9),statusIndicator[_0xc72060(0x104)][_0xc72060(0x19e)]('animate-pulse',!_0x616fb9));if(statusText)statusText[_0x39b413(0x261)]=_0x616fb9?_0x39b413(0x2e7):_0xc72060(0x15b);if(connectionStatus)connectionStatus[_0xc72060(0x20a)]=_0x616fb9?_0xc72060(0x21a):_0xc72060(0x1e2);enableChatInput(_0x616fb9),!_0x616fb9?appendSystemMessage(_0xc72060(0x187),_0x39b413(0x200)):console[_0xc72060(0x168)](_0xc72060(0x152));}),modelSelect&&modelSelect[_0x179245(0x1a4)](_0x179245(0x234),_0x32183e=>{const _0x3a68e1=_0x383c84,_0x35040f=_0x179245,_0x5765c3=_0x32183e[_0x3a68e1(0x219)][_0x35040f(0x151)];_0x5765c3!==currentModelId&&(currentModelId=_0x5765c3,console[_0x35040f(0x168)](_0x35040f(0x1a7)+currentModelId),loadChatHistoryAndInit());}),btnGeneralChat&&btnGeneralChat[_0x179245(0x1a4)](_0x383c84(0x240),()=>{const _0x1f28a9=_0x383c84,_0x117d0e=_0x179245;if(currentChatView!==_0x117d0e(0x1f3)){currentChatView=_0x117d0e(0x1f3),targetChatId=null;if(userSearchInput)userSearchInput[_0x1f28a9(0x2b0)]='';loadChatHistoryAndInit();}}),btnMyChat&&btnMyChat[_0x179245(0x1a4)](_0x383c84(0x240),()=>{const _0x4a192e=_0x179245;if(!USER_DEVICE_ID){appendSystemMessage(_0x4a192e(0x1a3),_0x4a192e(0x16a)),showWelcomeModal();return;}if(currentChatView!==_0x4a192e(0x1cd)){currentChatView=_0x4a192e(0x1cd),targetChatId=null;if(userSearchInput)userSearchInput[_0x4a192e(0x151)]='';loadChatHistoryAndInit();}}),btnOtherChat&&btnOtherChat[_0x179245(0x1a4)](_0x179245(0x1be),()=>{const _0x28823b=_0x383c84,_0x14970e=_0x179245,_0x596b0b=userSearchInput[_0x28823b(0x2b0)][_0x14970e(0x1a2)]();if(!_0x596b0b){appendSystemMessage(_0x14970e(0x220),_0x14970e(0x1e8)),userSearchInput[_0x14970e(0xe6)]();return;}currentChatView=_0x14970e(0x225),loadChatHistoryAndInit();}),userSearchInput&&userSearchInput[_0x179245(0x1a4)](_0x179245(0x1b5),_0x168c46=>{const _0x2b92a8=_0x383c84,_0x280bf8=_0x179245;_0x168c46['key']===_0x280bf8(0x175)&&(_0x168c46[_0x280bf8(0x1ea)](),btnOtherChat[_0x2b92a8(0x240)]());}),messageForm&&messageForm['addEventListener'](_0x179245(0x1ec),async _0x46ea0c=>{const _0x571961=_0x383c84,_0x33a582=_0x179245;_0x46ea0c[_0x33a582(0x1ea)]();const _0x13b728=messageInput[_0x571961(0x2b0)][_0x571961(0x2c9)]();if(!_0x13b728)return;if(currentChatView===_0x33a582(0x225)){appendSystemMessage(_0x33a582(0x1f0),_0x33a582(0x16a));return;}if(currentChatView!==_0x33a582(0x1f3)&&currentChatView!==_0x33a582(0x1cd)){appendSystemMessage(_0x33a582(0x129),_0x33a582(0x16a));return;}if(!USER_DEVICE_ID||!USERNAME){appendSystemMessage(_0x33a582(0x22d),_0x33a582(0x16a)),showWelcomeModal();return;}if(!chat){appendSystemMessage(_0x33a582(0x21c),_0x33a582(0x16a));return;}if(!genAI){appendSystemMessage(_0x33a582(0x16d),_0x33a582(0x16a));return;}let _0x31cac4=null;const _0x1e03d8=sanitizeForFirebasePath(currentModelId);if(!_0x1e03d8){appendSystemMessage(_0x571961(0x1a6),_0x33a582(0x16a));return;}if(currentChatView===_0x33a582(0x1f3))_0x31cac4=_0x571961(0x2e3)+_0x1e03d8;else currentChatView===_0x571961(0x2d0)&&(_0x31cac4=_0x33a582(0x21b)+USER_DEVICE_ID+'/'+_0x1e03d8);if(!_0x31cac4){appendSystemMessage(_0x33a582(0x1f8),_0x33a582(0x16a));return;}enableChatInput(![]);const _0x47d8c5={'text':_0x13b728,'sender':_0x33a582(0x116),'timestamp':firebase[_0x33a582(0xf2)][_0x33a582(0x156)][_0x33a582(0x18b)],'deviceId':USER_DEVICE_ID,'username':USERNAME},_0x26e95f=database[_0x33a582(0x237)](_0x31cac4)[_0x33a582(0x1ba)]();try{await _0x26e95f[_0x33a582(0x1d7)](_0x47d8c5),console[_0x33a582(0x168)](_0x33a582(0xe7)+USERNAME+'/'+USER_DEVICE_ID+_0x33a582(0xe2)+_0x31cac4+':',_0x26e95f[_0x33a582(0x17f)]),messageInput[_0x33a582(0x151)]='',await getGeminiResponse(_0x13b728);}catch(_0x82bf38){console[_0x33a582(0x16a)](_0x571961(0x29e),_0x82bf38),appendSystemMessage(_0x571961(0x1ff),_0x33a582(0x16a)),enableChatInput(!![]);}finally{!messageInput[_0x33a582(0xff)]&&messageInput[_0x571961(0x25c)]();}}),saveUsernameBtn&&saveUsernameBtn[_0x179245(0x1a4)](_0x383c84(0x240),handleSaveUsername),usernameInput&&usernameInput[_0x179245(0x1a4)](_0x383c84(0x278),_0x4d5068=>{const _0x356b7b=_0x179245;_0x4d5068[_0x356b7b(0x17f)]===_0x356b7b(0x175)&&handleSaveUsername();}),window[_0x179245(0x1a4)](_0x383c84(0x294),()=>{const _0x566a4b=_0x179245;console[_0x566a4b(0x168)](_0x566a4b(0x188)),populateModelSelector(),setupUser();if(messageInput)messageInput[_0x566a4b(0xe6)]();console[_0x566a4b(0x168)](_0x566a4b(0x15c));});
</script>

</body>
</html>